<div class="content">
    <div class="container-fluid">
  
        <div class="row">
            <div class="col-lg-4 col-md-5">
                <div class="card card-user">
                    <div class="image">
                        <img src="/assets/img/background.jpg" alt="...">
                    </div>
                    <div class="content">
                        <div class="author">
                            <img class="avatar border-white" src="/assets/img/faces/face-1.jpg" alt="...">
                            <h4 class="title">
                                <% dataedit.order.forEach(data => { %>
                                <a href="/donor/edit" target="_blank"><%=data.firstname%> <%=data.lastname%></a>
                                <% }) %>
                            </h4>
                        </div>
                        <ul class="leftnav">
                            <li>
                                <p class="description">
                                    <a href="javascript:void(0)">สะสมบุญเดือนละ 300</a>
                                </p>
                            </li>
                            <li>
                                <p class="description">
                                    <a href="javascript:void(0)">สะสมบุญเดือนละ 1000</a>
                                </p>
                            </li>
                        </ul>
                    </div>
                    <hr>
                    <div class="text-center">
                        <div class="row">
                            
                            <div class="col-md-12">
                                <% dataedit.order.forEach(data => { %>
                                <h5><small>สถานะการชำระเงิน</small> <span class="alert alert-warning"><%=data.lov_payment_status%></span></h5>
                                <% }) %>
                            </div>
                        </div>
                    </div>
                </div>
  
            </div>
            <div class="col-lg-8 col-md-7">
                <div class="card">
                    <div class="header">
                        <h4 class="title">ข้อมูลโครงการบริจาค</h4>
                    </div>
                    <div class="content">
                        <form action="/order/save" method="POST">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <% dataedit.order.forEach(data => { %>
                                        <label>ชื่อ</label>
                                        <input class="form-control border-input" placeholder="กรุณากรอกชื่อ"  type="text" name="fname" value="<%=data.firstname%>">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>สกุล</label>
                                        <input class="form-control border-input" placeholder="กรุณากรอกสกุล" type="text" name="lname" value="<%=data.lastname%>">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>จุดตั้งรับ</label>
                                        <select class="form-control border-input" name="servicepoint">
                                            
                                            <option value="<%=data.lov_service_point_id%>"><%=data.lov_service_point%></option>
                                            <% }) %>
                                            <% dataedit.lov_ser_point.forEach(data => { %>
                                            <option value="<%= data.id%>"><%= data.text%></option>
                                            <% }) %>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <% dataedit.order.forEach(data => { %>
                                        <label>โครงการบริจาค</label>
                                        <input class="form-control border-input" placeholder="Company"  type="text" name="ordername" value="<%=data.order_name%>">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>ยอดร่วมทำบุญ (บาท)</label>
                                        <input class="form-control border-input" placeholder="กรุณากรอกตัวเลข" type="number" name="total" value="<%=data.total%>">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>โครงการ</label>
                                        <select class="form-control border-input" name="project">
                                            <option value="<%=data.project_id%>"><%=data.project%></option><% }) %>
                                            <% dataedit.sql_lov_project.forEach(data => { %>
                                                <option value="<%= data.id%>"><%= data.text%></option>
                                            <% }) %>
                                        </select>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>ของที่ระลึกโครงการ</label>
                                    </div>
                                    <% dataedit.sql_lov_product.forEach(data => { %>
                                    <div class="checkbox">
                                        
                                        <label><input type="checkbox" name="product" value="<%= data.id%>" ><%= data.name%></label>
                                        
                                    </div><% }) %>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>ประเภทการชำระเงิน</label>
                                        <select class="form-control border-input" name="paymenttype">
                                            <% dataedit.order.forEach(data => { %>
                                            <option value="<%=data.lov_transfer_type_id%>"><%=data.lov_transfer_type%></option>
                                            <% }) %>
                                            <% dataedit.sql_lov_payment.forEach(data => { %>
                                                <option value="<%= data.id%>"><%= data.text%></option>
                                            <% }) %>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <% dataedit.order.forEach(data => { %>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>จำนวนงวดการชำระเงิน</label>
                                        <input class="form-control border-input" placeholder="จำนวนงวดการชำระเงิน"  type="number" min="1" max="12" name="paymentperiod" value="<%=data.payment_period%>">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>&nbsp;</label>
                                        <a href="#" class="btn btn-default btn-fill">ตั้งค่างวดการชำระเงิน</a>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>สถานะการชำระเงิน</label>
                                        <select class="form-control border-input" name="paymentstatus">
                                            <option value="<%=data.lov_payment_status_id%>"><%=data.lov_payment_status%></option><% }) %>
                                            <% dataedit.sql_lov_payment_status_group.forEach(data => { %>
                                                <option value="<%= data.id%>"><%= data.text%></option>
                                            <% }) %>
                                            
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <% dataedit.order.forEach(data => { %>
                                        <label>หมายเหตุ</label>
                                        <textarea rows="2" class="form-control border-input" placeholder="Here can be your description" value="" name="comment"><%=data.comment%></textarea>
                                        
                                        <br><button class="btn btn-info btn-fill addnew"  type="submit">บันทึก</button>
                                        <input type="hidden" class="btn btn-info btn-fill btn-wd" name="id" value="<%= data.id %>">
                                        <% }) %>  
                                    </div>
                                </div>
                            </div>
                           
                        </form>
                    </div>
                </div>
            </div>
  
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="header">
                        <h4 class="title">รายละเอียดการชำระเงิน</h4>
                        <p class="category"></p>
                    </div>
  
                    <div class="content table-responsive table-full-width">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>งวดที่</th>
                                    <th>ยอดเงิน (บาท)</th>
                                    <th>วันที่แจ้งยอด</th>
                                    <th>วันที่จ่ายจริง</th>
                                    <th class="text-center">Transfer type</th>
                                    <th class="text-center">ต้องการใบร่วมบุญ</th>
                                </tr>
                            </thead>
                            
                            
                        </table>
                        <form method="post" action="receive.php">
                            <div id="cover"> 
                            </div>
                            <br><br>
                            <input type="button" id="btnAdd" value="add" class="btn" />
                         </form>
                            <input type="button" id="btnSend" value="send" class="btn"/>
                    </div>
                    
                    <div class="row content-container">
                        <form method="get" action="" class="search-container"></form>
                            <div class="col-md-12 text-center">
                                <a class="btn btn-info btn-fill addnew" href="#">บันทึก</a>
                            </div>
                        </form>
                    </div>
                    <br/>
                </div>
            </div>
        </div>
    </div>
  </div>
  
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script>
	$(document).ready(function(){
		first();                   // เมื่อ page ถูกโหลดจะทำฟังก์ชัน first ก่อน
		$('#btnAdd').click(first); // เมื่อ click จะสร้าง element ขึ้นมาใหม่(สร้างอินพุตใหม่)
		$('#btnSend').click(send); //เมื่อคลิกจะทำฟังก์ชัน send
	});
	
	function first(){
		var id = $('#cover select').length+1;            // นับว่ามี tag div กี่อันแล้ว แล้ว +1
		var wrapper = $("<div id=\"field"+id+"\">");  // สร้าง div
		// var parag   = $("<p>เบอร์โทร\""+id+"\"</p>");   // สร้าง p
		var text    = $("<div class=\"content table-responsive table-full-width\"><table class=\"table table-striped\"><thead><tbody><tr><td><span>"+id+"</span></td><td><input class=\"form-control border-input\"  value=\"0\" type=\"text\" name=\"total\"></td><td><input class=\"form-control border-input\" \  type=\"text\" name=\"notidate\"></td><td><input class=\"form-control border-input\"  type=\"text\" name=\"paydate\"></td><td><select class=\"form-control border-input\" name=\"status\"><option>Cash</option><option>Tranfer</option><option>Credit</option></select></td><td class=\"text-center\" style=\"display:block;\"><div class=\"checkbox\" style=\"margin:0 auto\"><label><input type=\"checkbox\" name=\"receipt\"></label></div></td></tr></tbody></thead></table></div>"); // สร้าง input
		var btnDel  = $("<input type='button' class=\"btn\" value='del' id=\"btn"+id+"\"/>"); 
		btnDel.click(function(){
			$(this).parent().remove();			
		});
		
		// wrapper.append(parag);   
		wrapper.append(text);
		wrapper.append(btnDel);
		$('#cover').append(wrapper);
	}
	
	function send(){  //นับ div ทั้งหมดก่อนส่ง
		var id= $('#cover div').length;
		var hiddens = $("<input type='hidden' name='hidden' value=\""+id+"\"/>");
		$('form').append(hiddens);
		$('form').submit(); 
	}
</script>